{% extends '@Main/layout.html.twig' %}
{% import _self as macros %}
{% block title %}
    {{ block.book.title }} - {{ block.title }} - Édit
{% endblock %}
{% block body %}
<div id="prototypes" data-block="{{ block.id }}"  data-authorization-prototype="
        {% filter escape %}
            {{ include('form/form.block.authorization.html.twig') }}
        {% endfilter %}">
    </div>
    <!-- BEGIN PAGE BASE CONTENT -->
    <div class="page-bar">
        <ul class="page-breadcrumb">
            <li>
                <i class="fa fa-home"></i>
                <a href="{{ url('administrator_homepage') }}">Tableau de bord</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <i class="fa fa-book"></i>
                <a href="{{ url('administrator_books') }}">Liste des livres</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <a href="{{ url('administrator_edit_book',{token:block.book.token}) }}">{{ block.book.title }}</a>
                <i class="fa fa-angle-right"></i>
            </li>
            <li>
                <span class="active">
                    {{ block.title }}
                </span>
            </li>

        </ul>
    </div>
        <div class="m-heading-1 border-green m-bordered row" style="margin-bottom: 17px;">
            <h2><span class="fa fa-book"></span> &nbsp; {{ block.title }}</h2>
        </div>
    <div class="row">
        <div class="col-md-12">
            <div class="portlet box green-meadow col-md-12">
                        <div class="portlet-title">
                            <h4 class="pull-left">Structure du bloc</h4>
                            <div class="tools">
                                <a href="javascript:;" data-placement="bottom" class="collapse" data-original-title="reduire" title=""> </a>
                                <a href="" class="fullscreen" data-placement="bottom" data-original-title="plein ecran" title=""> </a>
                            </div>
                            <div class="pull-right" style="margin-top: 5px;margin-right: 10px">
                             {% if block.parent is not null %}
                                <a href="{{ url('administrator_book_block',{token:block.parent.token} ) }}" class="btn btn-sm default" >
                                    <i class="fa fa-arrow-left"></i>
                                    Bloc Précedent
                                </a>
                                {% endif %}
                            <button data-toggle="modal" href="#new-block-modal"  class="btn btnnn btn-success btn-sm ">
                                <i class="fa fa-plus"></i>&nbsp;
                                Ajouter un bloc
                            </button>
                            </div>
                        </div>
                        <div class="portlet-body col-md-12">
                            <div class="col-md-12 fakeTable" id="blockTree">
                                <table class="table table-bordered  " cellspacing="0" width="100%" style="margin: 0px;">
                                    <thead>
                                    <tr>
                                        <th class="col-md-5 col-sm-6 col-xs-6">Titre du block</th>
                                        <th class="col-md-2 text-center hidden-sm hidden-xs">Dernière version Validée</th>
                                        <th class="text-center col-md-2 col-sm-2 col-xs-2">Version Puliée</th>
                                        <th class="text-center col-md-3 col-sm-4 col-xs-4 text-center">Actions</th>
                                    </tr>
                                    </thead>
                                </table>
                                {% macro displayVersionBlock(blocks,firstBlock) %}
                                    {% import _self as macros %}
                                    {% for bl in blocks| sortbyfield('position') %}
                                        <li class="block-branch {% if bl.parent != firstBlock %} hidden {% endif %}"
                                            data-id={{ bl.id }}
                                            data-parent={% if bl.parent is not null %}{{ bl.parent.id }}{% else %}null{% endif %}
                                            data-level={{ bl.level-firstBlock.level-1 }}
                                            data-position={{ bl.position }}>
                                            <div>
                                                <div class="cl-btn fake-column col-md-5 col-sm-6 col-xs-6 " data-pdl=25>
                                                    {% if bl.childrens|length>0 %}
                                                        <button  class="btn green  btn-show-children"><i
                                                                    class=" fa fa-plus"></i></button>
                                                    {% endif %}
                                                    <input style="pointer-events: none" readonly type="text" id="title-{{ bl.id }}" class="form-control"
                                                           value="{{ bl.title }}">
                                                </div>
                                                 <div class="fake-column col-md-2 hidden-sm hidden-xs text-center">
                                                    <div class="label label-success ">
                                                        {% if bl.lastValidatedVersion is not null %}
                                                            {{ bl.lastValidatedVersion.number|number_format(1,'.',',') }}
                                                        {% else %}
                                                            pas de version
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="fake-column col-md-2 col-sm-2 col-xs-2 text-center" >
                                                    <div class="label label-success ">
                                                        {% if bl.publishedVersion is not null %}
                                                            {{ bl.publishedVersion.number|number_format(1,'.',',') }}
                                                        {% else %}
                                                            pas de version
                                                        {% endif %}
                                                    </div>
                                                </div>
                                               <div class="fake-column actions col-md-3 col-sm-4 col-xs-4 text-center">
                                                    <div >
                                                        <a class="btn green btn-icon-only"
                                                           href="{{ url('administrator_book_block',{token:bl.token}) }}">
                                                            <i class="fa fa-eye"></i></a>
                                                    </div>

                                                    <div  data-toggle="tooltip" data-title="Détails">
                                                        <a href="#block_info_{{ bl.id }}" data-toggle="modal"
                                                           class="btn blue btn-icon-only"><i class="fa fa-cog"></i></a>
                                                    </div>
                                                    <div data-toggle="tooltip"
                                                         data-title="Effacer!">
                                                        <button type="button" class="btn red btn-icon-only btn-delet-block"
                                                                data-id="{{ bl.id }}">
                                                            <i class="fa fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            {% if bl.childrens|length>0 %}
                                                <ol>
                                                    {{ macros.displayVersionBlock(bl.childrens|sortByPosition,firstBlock) }}
                                                </ol>
                                            {% endif %}
                                        </li>
                                    {% endfor %}

                                {% endmacro %}
                                <ol class="sortable ">
                                    {{ macros.displayVersionBlock(block.childrens|sortByPosition,block) }}
                                </ol>
                            </div>
                                <div class="hiddenForm col-md-12" style="margin-top: 50px">
                                    <div id="block-fields-list" style="list-style: none">
                                         {% for bl in block.childrens %}
                                            <div class="block-field " id="block_{{ bl.id }}">
                                                <div data-book="{{ bl.id }}" class="modal fade fill-in blockModal" id="block_info_{{ bl.id }}" tabindex="-1" aria-hidden="true">
                                                    <a type="button" class="close-modal" data-dismiss="modal" aria-hidden="true">
                                                        <i class="fa fa-times"></i>
                                                    </a>
                                                    <div class="modal-dialog">
                                                        <form action="{{ url('administrator_update_block',{id:bl.id}) }}" class="updateBlockForm" data-parent="{{ block.id }}">
                                                            <div class="modal-content row">
                                                                <div class="modal-header">
                                                                    <h2><i class="fa fa-pencil"></i>&nbsp; Détails du bloc</h2>
                                                                </div>
                                                                <div class="modal-body col-md-12">
                                                                    <div class="form-group col-md-12">
                                                                        <label for="blockTitle" class="col-sm-4 control-label">Titre du bloc</label>
                                                                        <div class="col-sm-8">
                                                                            <input value="{{ bl.title }}" name="blockTitle" required type="text" class="form-control" id="blockTitle"
                                                                                   placeholder="Titre du bloc">
                                                                        </div>
                                                                    </div>
                                                                    <div class="form-group text-center col-md-12">
                                                                        <label class="col-md-4" style="display: flex" for="showTitle">
                                                                            <div class="custom-check">
                                                                                <input  {% if bl.options.showTitle %} checked  {% endif %} id="showTitle" name="showTitle" type="checkbox" role="checkbox"
                                                                                       class="custom-check-input">
                                                                            </div>
                                                                            Afficher Titre
                                                                        </label>
                                                                        <label class="col-md-4" style="display: flex" for="indexed">
                                                                            <div class="custom-check">
                                                                                <input {% if bl.options.indexed %} checked  {% endif %} id="indexed" name="indexed" type="checkbox" role="checkbox"
                                                                                       class="custom-check-input">
                                                                            </div>
                                                                            Table des matières
                                                                        </label>
                                                                        <label class="col-md-4" style="display: flex" for="paginated">
                                                                            <div class="custom-check">
                                                                                <input {% if bl.options.paginated %} checked  {% endif %} id="paginated" name="paginated" type="checkbox" role="checkbox"
                                                                                       class="custom-check-input">
                                                                            </div>
                                                                            Pagination
                                                                        </label>
                                                                    </div>
                                                                    <div class="auths">
                                                                        <h4>Autorization</h4>
                                                                            <table class="table table-striped table-bordered table-hover auth-tb-author"
                                                                                   cellspacing="0" width="100%">
                                                                                <thead>
                                                                                <tr>
                                                                                    <th>Auteur</th>
                                                                                    <th>Lecture</th>
                                                                                    <th>Ecriture</th>
                                                                                    <th>Supression</th>
                                                                                    <th><span data-toggle="tooltip" data-placement="bottom"
                                                                                              title="Limiter l'autorisation seulement a ce bloc">Strict</span></th>
                                                                                    <th>Action</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                {% for authorization in bl.authorizations %}
                                                                                    {% if 'ROLE_AUTHOR' in authorization.user.roles %}
                                                                                        <tr class="text-center">
                                                                                            <td>
                                                                                                <select class="form-control" name="auth_user">
                                                                                                    {% for user in authors %}
                                                                                                        <option {% if  authorization.user.id == user.id %} selected {% endif %}
                                                                                                                value="{{ user.id }}">{{ user.profile.fullName }}</option>
                                                                                                    {% endfor %}
                                                                                                </select>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div class="custom-check">
                                                                                                    <input type="checkbox" class="custom-check-input" name="canRead"
                                                                                                        {% if authorization.canRead %} checked {% endif %} value="{{ authorization.canRead }}">
                                                                                                </div>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div class="custom-check">
                                                                                                    <input type="checkbox" class="custom-check-input" name="canWrite"
                                                                                                        {% if authorization.canWrite %} checked {% endif %} value="{{ authorization.canWrite }}">
                                                                                                </div>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div class="custom-check">
                                                                                                    <input type="checkbox" class="custom-check-input" name="canDelete"
                                                                                                        {% if authorization.canDelete %} checked {% endif %} value="{{ authorization.canDelete }}">
                                                                                                </div>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div class="custom-check">
                                                                                                    <input type="checkbox" class="custom-check-input" name="limited"
                                                                                                        {% if authorization.limited %} checked {% endif %} value="{{ authorization.limited }}">
                                                                                                </div>
                                                                                            </td>

                                                                                            <td class="text-center">
                                                                                                <button data-toggle="tooltip"
                                                                                                        data-placement="top" title="Effacer ! "
                                                                                                        class="btn btn-circle btn-icon-only red remove-auth">
                                                                                                    <i class="fa fa-minus"></i>
                                                                                                </button>
                                                                                            </td>
                                                                                        </tr>
                                                                                    {% endif %}
                                                                                {% endfor %}
                                                                                </tbody>
                                                                                {% if authors|length>0 %}
                                                                                <tfoot>
                                                                                <tr>
                                                                                    <td colspan="6" class="col-md-12">
                                                                                        <button type="button" id="addAuthor" class="btn green btn-circle btn-icon-only add-auth-btn" ><i
                                                                                                    class="fa fa-plus"></i></button>
                                                                                        ajouter un auteur
                                                                                    </td>
                                                                                </tr>
                                                                                </tfoot>
                                                                                {% endif %}
                                                                            </table>

                                                                            <table class="table table-striped table-bordered table-hover auth-tb-validator"
                                                                                   cellspacing="0" width="100%">
                                                                                <thead>
                                                                                <tr class="text-center">
                                                                                    <th>Validateur</th>
                                                                                    <th>
                                                                                        <span data-toggle="tooltip" data-placement="bottom"
                                                                                              title="Limiter l'autorisation seulement a ce bloc">Strict</span>
                                                                                    </th>
                                                                                    <th>Action</th>
                                                                                </tr>
                                                                                </thead>
                                                                                <tbody>
                                                                                {% for authorization in bl.authorizations %}
                                                                                    {% if 'ROLE_VALIDATOR' in authorization.user.roles %}
                                                                                        <tr class="text-center">
                                                                                            <td>
                                                                                                <select class="form-control" name="auth_user">
                                                                                                    {% for user in validators %}
                                                                                                        <option {% if  authorization.user.id == user.id %} selected {% endif %}
                                                                                                                value="{{ user.id }}">{{ user.profile.fullName }}</option>
                                                                                                    {% endfor %}
                                                                                                </select>
                                                                                            </td>
                                                                                            <td>
                                                                                                <div class="custom-check">
                                                                                                    <input type="checkbox" class="custom-check-input" name="limited"
                                                                                                        {% if authorization.limited %} checked {% endif %}  value="{{ authorization.limited }}">
                                                                                                </div>
                                                                                            </td>
                                                                                            <td class="text-center">
                                                                                                <button data-toggle="tooltip"
                                                                                                        data-placement="top" title="Effacer ! "
                                                                                                        class="btn btn-circle btn-icon-only red remove-auth">
                                                                                                    <i class="fa fa-minus"></i>
                                                                                                </button>
                                                                                            </td>
                                                                                        </tr>
                                                                                    {% endif %}
                                                                                {% endfor %}
                                                                                </tbody>
                                                                                {% if validators|length>0 %}
                                                                                <tfoot>
                                                                                <tr>
                                                                                    <td colspan="3" class="col-md-12">
                                                                                        <button type="button" id="addValidator" class="btn green btn-circle btn-icon-only add-auth-btn" {% if validators|length==0  %} disabled {% endif %}><i
                                                                                                    class="fa fa-plus"></i></button>
                                                                                        ajouter un validateur
                                                                                    </td>
                                                                                </tr>
                                                                                </tfoot>
                                                                                {% endif %}
                                                                            </table>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-footer col-md-12">
                                                                    <div class="form-group">
                                                                        <div class="col-sm-offset-2 col-sm-10">
                                                                            <button type="submit" class="btn green">Sauvegarder</button>
                                                                            <button data-dismiss="modal" role="button" class="btn red">Annuler</button>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                    </div>
                </div>
            {% if block.publishedVersion is not null %}
                <div class="portlet box green-meadow col-md-12" style="margin-bottom: 15px">
                    <div class="portlet-title">
                        <h4 class="pull-left">Contenu du bloc</h4>
                        <div class="tools">
                            <a href="javascript:;" class="collapse" data-original-title="reduire" data-placement="bottom" title=""> </a>
                            <a href="" class="fullscreen" data-original-title="plein ecran" data-placement="bottom" title=""> </a>
                        </div>
                    </div>
                    <div class="portlet-body col-md-12">
                        <div class="col-md-12" style="display: block;">
                            <textarea class="tinyMince">{{ block.publishedVersion.content }}</textarea>
                        </div>
                    </div>
                </div>
                <div id="fm-token" data-token="{{ block.publishedVersion.token }}"></div>
            {% endif %}
            <div class="portlet box green-meadow col-md-12" style="margin-bottom: 15px">
                    <div class="portlet-title">
                        <h4 class="pull-left">Versions du bloc</h4>
                        <div class="tools">
                            <a href="javascript:;" class="collapse" data-original-title="reduire" data-placement="bottom" title=""> </a>
                            <a href="" class="fullscreen" data-original-title="plein ecran" data-placement="bottom" title=""> </a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <table class="table table-bordered ">
                            <thead>
                                <tr>
                                    <th class="text-center ">Date Creation</th>
                                    <th class="text-center">Crée Par</th>
                                    <th class="text-center">Numéro</th>
                                    <th class="text-center">Status</th>
                                    <th class="text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for version in block.versions|sortbyfield('createdAt')|reverse %}
                                <tr class="text-center">
                                    <td>{{ version.createdAt|date('d-m-Y') }}</td>
                                    <td>{{ version.createdBy.profile.fullName }}</td>
                                    <td >
                                        <div style="font-size: 10px!important;" class="label label-success"> v {{ version.number|number_format(1,'.',',') }}</div>
                                    </td>
                                    <td >
                                        {% if version.status==3 %}
                                            <div class="label label-success">publiée</div>
                                        {% elseif version.status==2 %}
                                           <div class="label label-info">validée</div>
                                        {% else %}
                                           <div class="label label-warning">en cours</div>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if version.status==3 %}
                                            <button type="button" class="btn green disabled btn-sm">Active</button>
                                        {% elseif version.status==2 %}
                                            <button data-url="{{ url('administrator_publish_block_version',{token:version.token}) }}" type="button"
                                               class="btn default btn-sm btn-activate-version ">Activer la version</button>
                                            <button href="#animatedModal" type="button"  class="btn blue btn-cmp-version"
                                            data-content="{{ version.content|raw|convert_encoding('UTF-8', 'HTML-ENTITIES') }}"
                                             data-author="{{ version.createdBy.profile.fullName }}" data-vnumber="{{ version.number|number_format(1,'.',',') }}"
                                            data-toggle="tooltip" data-title="Comparer avec la version actuelle"><i class="fa fa-exchange"></i>Différence</button>
                                        {% else %}
                                            {% if version.status==0 %}
                                                <a href="{{ url('administrator_display_version_progression',{token:version.token}) }}" class="btn blue btn-sm"><i class="fa fa-eye"></i> suivie </a>
                                            {% endif %}
                                            <button type="button" class="btn default btn-sm disabled">Active</button>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                 <!-- needed to load file from current version -->
            <div class="portlet box green-meadow col-md-12">
                    <div class="portlet-title">
                        <h4 class="pull-left">Historique du bloc</h4>
                        <div class="tools">
                            <a href="javascript:;" data-placement="bottom" class="collapse" data-original-title="reduire" title=""> </a>
                            <a href="" class="fullscreen" data-placement="bottom" data-original-title="plein ecran" title=""> </a>
                        </div>
                    </div>
                    <div class="portlet-body col-md-12">
                        <table class="table table-hover table-bordered">
                        	<thead>
                        		<tr>
                        			<th class="col-md-2 text-center"> Date </th>
                                    <th class="text-center"> Information </th>
                        		</tr>
                        	</thead>
                        	<tbody>
                        	{% for historic in block.historics|sortbyfield('date','desc') %}
                        	    <tr>
                        		    <td class="text-center">{{ historic.date|date('d-m-Y H:i') }}</td>
                        		    <td>{{ historic.message }} </td>
                                </tr>
                        	{% endfor %}
                        	</tbody>
                        </table>

                    </div>
                </div>
    </div>
 <!--DEMO01-->
    <div id="animatedModal" style="z-index: 99999">
            <div id="closebt-container" class="close-animatedModal">
                <img class="closebt" src="{{ asset('assets/img/closebt.svg') }}">
            </div>
        <div  id="animatedModal-content" class="modal-content">
            <h2 class="text-center bold font-green"> Comparaison de version </h2>
            <div class="col-md-12">
                <h4 class="col-md-6 text-center" style="color: grey">
                    <span class="col-md-5">Numéro version : <strong>{% if block.publishedVersion is not null  %}{{ block.publishedVersion.number|number_format(1,'.',',')  }} {% endif %}</strong></span>
                    <span class="col-md-7">&nbsp;&nbsp;- &nbsp; Crée par : <strong>{% if block.publishedVersion is not null  %} {{ block.publishedVersion.createdBy.profile.fullName }} {% endif %}</strong></span>
                </h4>
                <h4 class="col-md-6 text-center" style="color: grey">
                    <span class="col-md-5">Numéro version : <strong id="cmpv-number"></strong></span>
                    <span class="col-md-7">&nbsp;&nbsp;- &nbsp; Crée par : <strong id="cmpv-author"></strong></span>
                </h4>
            </div>
            <div class="col-md-12" id="compare">

            </div>
        </div>
    </div>
    <input type="hidden" value="" id="menuSelected" data-menu="page-my-books">
    <div id="currentVersion" class="hidden">{% if block.publishedVersion is not null %}{% spaceless %}{{ block.publishedVersion.content|convert_encoding('UTF-8', 'HTML-ENTITIES')}}{% endspaceless %}{% endif %}</div>
    <div id="newVersion" class="hidden"></div>

   <!-- new block modal -->
    <div data-book="{{ block.book.id }}" class="modal fade fill-in blockModal" id="new-block-modal" tabindex="-1" aria-hidden="true">
        <a type="button" class="close-modal" data-dismiss="modal" aria-hidden="true">
            <i class="fa fa-times"></i>
        </a>
        <div class="modal-dialog">
            <form  id="createBlockForm" action="{{ url('administrator_create_block',{book:block.book.id}) }}" data-parent="{{ block.id }}">
                <div class="modal-content row">
                    <div class="modal-header">
                        <h2><i class="fa fa-pencil"></i>&nbsp; Ajouter un bloc</h2>
                    </div>
                    <div class="modal-body col-md-12">
                        <div class="form-group col-md-12">
                            <label for="blockTitle" class="col-sm-4 control-label">Titre du bloc</label>
                            <div class="col-sm-8">
                                <input name="blockTitle" required type="text" class="form-control" id="blockTitle"
                                       placeholder="Titre du bloc">
                            </div>
                        </div>
                        <div class="form-group text-center col-md-12">
                            <label class="col-md-4" style="display: flex" for="showTitle">
                                <div class="custom-check">
                                    <input id="showTitle" name="showTitle" type="checkbox" role="checkbox"
                                           class="custom-check-input">
                                </div>
                                Afficher Titre
                            </label>
                            <label class="col-md-4" style="display: flex" for="indexed">
                                <div class="custom-check">
                                    <input id="indexed" name="indexed" type="checkbox" role="checkbox"
                                           class="custom-check-input">
                                </div>
                                Table des matières
                            </label>
                            <label class="col-md-4" style="display: flex" for="paginated">
                                <div class="custom-check">
                                    <input id="paginated" name="paginated" type="checkbox" role="checkbox"
                                           class="custom-check-input">
                                </div>
                                Pagination
                            </label>
                        </div>
                        <div class="auths">
                            <h4>Autorization</h4>
                            {% if authors|length>0 %}
                            <table class="table table-striped table-bordered table-hover auth-tb-author"
                                   cellspacing="0" width="100%">
                                <thead>
                                    <tr>
                                        <th>Auteur</th>
                                        <th>Lecture</th>
                                        <th>Ecriture</th>
                                        <th>Supression</th>
                                        <th><span data-toggle="tooltip" data-placement="bottom"
                                                  title="Limiter l'autorisation seulement a ce bloc">Strict</span></th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="6" class="col-md-12">
                                            <button type="button" id="addAuthor" class="btn green btn-circle btn-icon-only add-auth-btn" ><i
                                                        class="fa fa-plus"></i></button>
                                            ajouter un auteur
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                            {% endif %}
                            {% if validators|length>0 %}
                            <table class="table table-striped table-bordered table-hover auth-tb-validator"
                                   cellspacing="0" width="100%">
                                <thead>
                                    <tr class="text-center">
                                        <th>Validateur</th>
                                        <th>
                                            <span data-toggle="tooltip" data-placement="bottom"
                                                  title="Limiter l'autorisation seulement a ce bloc">Strict</span>
                                        </th>
                                        <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td colspan="3" class="col-md-12">
                                            <button type="button" id="addValidator" class="btn green btn-circle btn-icon-only add-auth-btn" {% if validators|length==0  %} disabled {% endif %}><i
                                                        class="fa fa-plus"></i></button>
                                            ajouter un validateur
                                        </td>
                                    </tr>
                                </tfoot>
                            </table>
                            {% endif %}
                        </div>
                    </div>
                    <div class="modal-footer col-md-12">
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="submit" class="btn green">Crée</button>
                                <button type="reset" data-dismiss="modal" role="button" class="btn red">Annuler</button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>

{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('assets/pages/css/book.structure.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/global/plugins/mergely-3.4.4/lib/mergely.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/global/plugins/mergely-3.4.4/lib/codemirror.css') }}">
    <style>
        .fake-column{
            vertical-align: middle;
        }
        #animatedModal-content{
            min-height:100px;
            margin-top: 50px;
            margin-bottom: 50px
        }
        #closebt-container {
            position: relative;
            width: 100%;
            text-align: center;
            margin-top: 40px;
        }
        .closebt{
            webkit-transition: all 0.2s;
            -moz-transition: all 0.2s;
            -ms-transition: all 0.2s;
            -o-transition: all 0.2s;
             transition: all 0.2s;
             cursor: pointer;
        }
        .closebt:hover{
            transform: rotate(90deg);
        }
        .center-all{
            display: grid;
            align-items: center;
        }
        .center-all>div{
            text-align: center;
        }
        .mergely-canvas ,.mergely-margin{
        display: none;!important;
        }
        .CodeMirror-scroll{
            height: 400px!important;
        }
        .CodeMirror{
            height: auto!important;
        }
        .mergely.a.rhs {
            background-color: #cfc!important;
            color: #399839!important;
            border-color:  #399839!important;
            border-radius: 4px 0 0 4px!important;;
        }
        .mergely.c.lhs.start, .mergely.c.rhs.start,
        .mergely.c.lhs.end, .mergely.c.rhs.end{
            border: none!important;
        }
        .label-success.ui-sortable-handle{
        vertical-align: sub;
        }
    </style>
{% endblock %}
{% block javascripts %}
    <script type="text/javascript" src="{{ asset('assets/global/plugins/jquery.mjs.nestedSortable.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/pages/js/book/edit_block_structure.js') }}"></script>
    <script src="{{ asset('assets/global/plugins/annimatedModal/animatedModal.js-master/animatedModal.min.js') }}"></script>
    <script src="{{ asset('assets/global/plugins/mergely-3.4.4/lib/codemirror.js') }}"></script>
    <script src="{{ asset('assets/global/plugins/mergely-3.4.4/lib/mergely.js') }}"></script>
    <script >
        $(document).ready(function() {
            $('.btn-cmp-version').animatedModal({afterOpen:function() {
                 $('#compare').mergely({
                    editor_width: 'calc(50% - 25px)',
                    editor_height: '100%',
                    sidebar:false,
                    ignorews:true,
                    cmsettings: {
                        readOnly: true,
                        lineNumbers: true ,
                        lineWrapping: true
                        },
                    lhs: function(setValue) {
                        setValue($('#currentVersion').text());
                    },
                    rhs: function(setValue) {
                        setValue($('#newVersion').text());
                    },
                    loaded:function () {
                        $('#animatedModal-content').css('height',$('.CodeMirror-scroll').height()+150)
                    }

                });
            }});
          $(document).on('click','.btn-activate-version',function() {
                var elem=$(this);
                var url = elem.data('url');
                $.ajax({
                    url: url,
                    method: 'POST',
                    beforeSend: function () {
                        $('.btn-activate-version').off();
                        elem.attr('disabled', true).addClass('yellow');
                        elem.html('<i class="fa fa-cog fa-2x fa-spin"></i>');
                        toastr.options.progressBar = true;
                        toastr.info('Chargement de la nouvelle version ')
                    },
                    success: function () {
                        location.reload();
                    }
                })
          });
          $(".btn-cmp-version").click(function() {
              content=$(this).data('content');
              author_name=$(this).data('author');
              version_number=$(this).data('vnumber');
                $('#newVersion').text(content);
                $('#cmpv-author').text(author_name);
                $('#cmpv-number').text(version_number);
          })
        })
    </script>
{% endblock %}