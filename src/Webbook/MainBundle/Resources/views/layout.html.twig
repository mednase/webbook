<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="{{ asset('assets/global/plugins/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/components-md.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/layout.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/themes/blue.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/custom.min.css') }}"/>
    <link rel="icon" type="image/x-icon" href="{{ asset('assets/img/mini-logo.png') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/font-awesome/css/font-awesome.min.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/datatables/datatables.min.css') }}" />
    <link  rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/bootstrap-table/bootstrap-table.min.css') }}"/>
    <link  rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/annimation.css') }}"/>
    <link rel="stylesheet" href="{{ asset('assets/ionicons/css/ionicons.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/simple-line-icons/simple-line-icons.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/pages/css/login.css') }}" />
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/bootstrap-sweetalert/sweetalert.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/bootstrap-toastr/toastr.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/select2/css/select2.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/select2/css/select2-bootstrap.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/main.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/bootstrap-summernote/summernote.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/plugins-md.min.css') }}"/>
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/material-icons/material.icons.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/global/plugins/jquery-ui-1.12.1/jquery-ui.min.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/global/plugins/bootstrap-fileinput/css/fileinput.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ asset('assets/layout/css/font/custom.font.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/pages/css/nav-bar.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/pages/css/custom-compo.css') }}">
    {% block stylesheets %}{% endblock %}
    <title>{% block title %} {% endblock  title %}</title>
</head>
<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid {% block classBody %}{% endblock %}">
<div id="page-loader" class="fade in">
    <span class="spinner"></span>
</div>
<!-- navbar-->
{% include '@Main/shared/navbar.html.twig' %}
<!-- end navbar-->
<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->

<!-- BEGIN CONTAINER -->
<div class="page-container">
        {% block menu %}
            {% if is_granted('ROLE_ADMINISTRATOR') %}
                {% include '::menu/menu.administrator.html.twig' %}
            {% elseif is_granted('ROLE_AUTHOR') %}
                {% include '::menu/menu.author.html.twig' %}
            {% elseif is_granted('ROLE_VALIDATOR') %}
                {% include '::menu/menu.validator.html.twig' %}
            {% endif %}
        {% endblock %}
    <div class="page-content-wrapper" >
        <div class="page-content {% block contentStyle %} {% endblock %}"  style="overflow: hidden!important; ">
            {% block body %}{% endblock %}
        </div>
    </div>
</div>

<div class="page-footer">
    <div class="page-footer-inner"> {{ date()|date("Y") }} © Mobilite.Tous les droits sont réservés.</div>
    <div class="scroll-to-top">
        <i class="icon-arrow-up"></i>
    </div>
</div>

<!-- socket lib-->
<script type="text/javascript" src="{{ asset('assets/pages/js/autobahn.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/pages/js/gos_web_socket_client.js') }}"></script>

<!--[if lt IE 9]>
<script type="text/javascript" src="{{ asset('assets/global/plugins/respond.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/excanvas.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/ie8.fix.min.js') }}"></script>
<![endif]-->

<script type="text/javascript" src="{{ asset('assets/global/plugins/jquery.min.js') }}"></script>
<script src="{{ asset('assets/global/plugins/jquery-ui-1.12.1/jquery-ui.min.js') }}"></script>

<script>
    // handle jQuery plugin naming conflict between jQuery UI and Bootstrap
    $.widget.bridge('uibutton', $.ui.button);
    $.widget.bridge('uitooltip', $.ui.tooltip);
</script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap/js/bootstrap.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/js.cookie.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-toastr/toastr.js') }}"></script>
<script src="{{ asset('assets/global/plugins/jquery-validation/js/jquery.validate.min.js') }}" type="text/javascript"></script>
<script src="{{ asset('assets/global/plugins/jquery-validation/js/additional-methods.min.js') }}" type="text/javascript"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-switch/js/bootstrap-switch.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/jquery-slimscroll/jquery.slimscroll.min.js') }}"></script>
<!-- END THEME GLOBAL SCRIPTS -->
<!-- BEGIN THEME LAYOUT SCRIPTS -->
<script src="{{ asset('assets/global/plugins/datatables/datatables.min.js') }}"></script>
<script src="{{ asset('assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.js') }}"></script>

<script type="text/javascript" src="{{ asset('assets/global/plugins/blockUI/blockUI.js') }}"></script>

<script src="{{ asset('assets/global/app.js') }}"></script>

<!-- FOS js routing -->
<script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
<script src="{{ path('fos_js_routing_js', { callback: 'fos.Router.setData' }) }}"></script>
<script src="{{ asset('assets/global/plugins/bootstrap-daterange/moment.min.js') }}"></script>
<script src="{{ asset('assets/global/plugins/bootstrap-daterange/moment.local.fr.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/layout/scripts/layout.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/layout/scripts/demo.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/layout/scripts/quick-sidebar.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/layout/scripts/quick-nav.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-sweetalert/sweetalert.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/select2/js/select2.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/select2/js/i18n/fr.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/pages/js/main.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-summernote/summernote.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-summernote/lang/summernote-fr-FR.js') }}"></script>
<script src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/plugins/piexif.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/plugins/canvas-to-blob.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/plugins/sortable.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/plugins/purify.min.js') }}"> </script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/fileinput.js') }}"> </script>
<script type="text/javascript" src="{{ asset('assets/global/plugins/bootstrap-fileinput/js/locales/fr.js') }}"> </script>
<script src="{{ asset('assets/global/plugins/tinymce/js/tinymce/tinymce.min.js') }}"></script>
<script src="{{ asset('assets/global/plugins/tinymce/js/tinymce/langs/fr_FR.js') }}"></script>
<script src="{{ asset('assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.js') }}"></script>

{% include '::menu/toaster.html.twig' %}
{% include '::menu/socket.html.twig' %}

{% block javascripts %}
{% endblock javascripts %}
<script>
    $(window).load(function () {
        $('#page-loader').addClass('hidden');

        var typingTimer;                //timer identifier
        var doneTypingInterval = 500;  //time in ms, 5 second for example
        var elem = $('#searchModalInput');
        //on keyup, start the countdown
        elem.on('keyup', function () {
            clearTimeout(typingTimer);
            typingTimer = setTimeout(doneTyping, doneTypingInterval);
        });
        //user is "finished typing," do something
        function doneTyping () {
            console.log("aaaa");
            var search=elem.val();
            $.ajax({
                url:Routing.generate('navbar_search'),
                data:{search:search},
                dataType:'JSON',
                success:function (data) {
                    var authorContainer=$('#author-search-result');
                    authorContainer.html("");
                    var bookContainer=$('#books-search-result');
                    bookContainer.html("");
                    $.each(data.authors,function (i,user) {
                        var picture =authorContainer.data('noimg');
                        if(user.picture)
                            picture=user.picture.path;
                        authorContainer.append(' <div class="foundAuthor  animated fadeIn col-md-2">'+
                            '<div><img class="img-circle" src="'+picture+'" alt="'+user.fullName+'"></div>'+
                            '<span>'+user.fullName+'</span></div>')
                    });
                    $.each(data.books,function (i,b) {
                        var picture =bookContainer.data('noimg');
                        if(b.images.length){
                            picture=b.images[0].path;
                        }
                        var authors="";
                        for(var i=0; i<b.main_authors.length;i++)
                            i===0? authors+=","+b.main_authors[i].fullName :authors+=b.main_authors[i].fullName;

                        bookContainer.append('<div class="foundBook animated fadeIn col-md-3">'+
                            '<div class="image">'+
                            '<img class="img-responsive"  src="'+picture+'" alt="'+b.title+'"></div>'+
                            '<div class="details"> <h5><a href="#">'+b.title+'</a></h5> <h6>Auteurs : '+authors+'</h6>'+
                            '</div> </div>')
                    });
                }
            })
        }
    })
</script>
</body>
</html>
